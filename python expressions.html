</body>
<footer style="font-family: 'IBM Plex Serif', serif; color: #002868; text-align: center; font-size: 15px; margin-top: 60px;">
  These tools were developed for teaching Cyber101 and AP Computer Science Principles at ASCTE by Mary Clair Wright and ASCTE Student Interns.
</footer>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expression Practice (Python)</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --maxw: 760px; }
    html, body { height: 100%; }
    body { font-family: "IBM Plex Sans", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, sans-serif; line-height: 1.45; margin: 0; background: #f7f7f8; color: #111; }
    main { margin: 0 auto; max-width: var(--maxw); padding: 24px; }
    .card { background: #fff; border: 1px solid #e6e6e6; border-radius: 14px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,.03); }
    .stack { display: grid; gap: 12px; }
    .row { display: flex; gap: 12px; align-items: center; }
    label { font-size: 14px; color: #333; }
    input[type="email"], input[type="text"] { width: 100%; padding: 12px 14px; border: 1px solid #d8d8de; border-radius: 10px; font-size: 16px; font-family: "IBM Plex Sans", sans-serif; }
    button { padding: 10px 14px; border: 1px solid #d0d0d6; border-radius: 10px; background: #fafafa; cursor: pointer; font-size: 15px; font-family: "IBM Plex Sans", sans-serif; }
    button:hover { background: #f0f0f3; }
    .muted { color: #555; font-size: 14px; }
    .question { font-size: 20px; margin: 6px 0 4px; font-family: "IBM Plex Sans", sans-serif; }
    .status { font-size: 14px; color: #444; }
    .good { color: #146c2e; }
    .bad { color: #8b1a1a; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .hidden { display: none; }
    .summary-table { width: 100%; border-collapse: collapse; }
    .summary-table th, .summary-table td { border-bottom: 1px solid #ececec; padding: 8px 6px; text-align: left; }
    .help { font-size: 14px; }
  </style>
</head>
<body>
  <main>
    <section class="card stack">
      <h1>Expression Practice</h1>
      <p class="muted">
        Enter your email to begin. You will work 10 expressions, one at a time. You have two attempts for each.
        For division (<span class="mono">/</span>), enter your answer as a float with exactly one decimal place
        (for example, <span class="mono">3.0</span>). Integers are required for <span class="mono">*</span>,
        <span class="mono">+</span>, and <span class="mono">//</span>. At most one negative number will appear in any expression.
      </p>
    </section>

    <section id="startSection" class="card stack">
      <label for="emailInput">Email</label>
      <input type="email" id="emailInput" placeholder="name@example.org" autocomplete="email" required />
      <div class="row">
        <button id="startBtn">Start</button>
        <span class="muted" id="startInfo"></span>
      </div>
    </section>

    <section id="quizSection" class="card stack hidden">
      <div class="row" style="justify-content: space-between;">
        <div id="progress" class="muted"></div>
        <div id="chances" class="muted"></div>
      </div>
      <div id="questionText" class="question"></div>
      <label for="answerInput">Answer</label>
      <input type="text" id="answerInput" inputmode="decimal" autocomplete="off" />
      <div class="row">
        <button id="submitBtn">Submit</button>
        <span id="feedback" class="status"></span>
      </div>
      <p class="help">
        Need a refresher on evaluating Python math expressions?
        <a href="https://www.youtube.com/watch?v=iOKaFL77iZE" target="_blank" rel="noopener">Watch this quick video</a>.
      </p>
    </section>

    <section id="resultSection" class="card stack hidden">
      <h2>Finished</h2>
      <div id="summary"></div>
    </section>
  </main>

<script>
(function(){
  // Helpers
  function randi(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
  function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function fmt1(x){ return (Math.round(x * 10) / 10).toFixed(1); }
  function pyFloorDiv(a, b){ return Math.floor(a / b); } // non-negative case matches Python

  function atMostOneNegative(vals){
    while (vals.filter(v => v < 0).length > 1) {
      for (let i=0;i<vals.length;i++){
        if (vals[i] < 0) { vals[i] = Math.abs(vals[i]); break; }
      }
    }
    return vals;
  }

  // Generators (no eval)
  // Q1–3: −5..5, *, +, parentheses, ≤1 negative, ≤3 values
  function genMulParenQuestion(){
    let a=randi(-5,5), b=randi(-5,5), c=randi(-5,5);
    [a,b,c] = atMostOneNegative([a,b,c]);
    const forms = [
      {t: `${a} * (${b} + ${c})`, v: a * (b + c)},
      {t: `(${a} + ${b}) * ${c}`, v: (a + b) * c},
      {t: `${a} * ${b} + ${c}`, v: a*b + c}
    ];
    const f = choice(forms);
    return { text: f.t, correct: String(f.v), type: 'int' };
  }

  // Q4–5: −5..5 ÷ {2,4,5,10}; answer as float with 1 decimal; ≤1 negative overall
  function genDivFloatQuestion(){
    const a = randi(-5,5);               // numerator can be negative
    const b = choice([2,4,5,10]);        // positive denom -> ≤1 negative total
    return { text: `${a} / ${b}`, correct: fmt1(a / b), type: 'float' };
  }

  // Q6–8: 0..30 // divisor; ensure at least one with 3 or 5
  function genFloorDivQuestion(i){
    const x = randi(0,30);
    const d = (i === 0) ? choice([3,5]) : choice([2,3,4,5,6,7,8,9]);
    return { text: `${x} // ${d}`, correct: String(pyFloorDiv(x, d)), type: 'int' };
  }

  // Q9–10: mixed from used ops; 0..30
  function genMixedQuestion(){
    const a=randi(0,30), b=randi(0,30), c=randi(0,30);
    const forms = [
      {t: `${a} * (${b} + ${c})`, v: a*(b+c), type:'int'},
      {t: `(${a} + ${b}) // ${c || 1}`, v: pyFloorDiv((a+b), (c||1)), type:'int'},
      {t: `${a} / (${b || 1})`, v: a/(b||1), type:'float'},
      {t: `${a} * ${b} + ${c}`, v: a*b + c, type:'int'},
      {t: `${a} / ((${b || 1}) + ${c})`, v: a/((b||1)+c), type:'float'}
    ];
    const f = choice(forms);
    const correct = f.type === 'float' ? fmt1(f.v) : String(f.v);
    return { text: f.t, correct, type: f.type };
  }

  function buildQuestions(){
    const qs = [];
    for (let i=0;i<3;i++) qs.push(genMulParenQuestion());
    for (let i=0;i<2;i++) qs.push(genDivFloatQuestion());
    for (let i=0;i<3;i++) qs.push(genFloorDivQuestion(i));
    for (let i=0;i<2;i++) qs.push(genMixedQuestion());
    return qs;
  }

  // UI state
  const ui = {
    start: document.getElementById('startSection'),
    quiz: document.getElementById('quizSection'),
    done: document.getElementById('resultSection'),
    startBtn: document.getElementById('startBtn'),
    startInfo: document.getElementById('startInfo'),
    email: document.getElementById('emailInput'),
    progress: document.getElementById('progress'),
    chances: document.getElementById('chances'),
    qText: document.getElementById('questionText'),
    answer: document.getElementById('answerInput'),
    submit: document.getElementById('submitBtn'),
    feedback: document.getElementById('feedback'),
    summary: document.getElementById('summary'),
  };

  let state = {
    email: '',
    startISO: null,
    stopISO: null,
    questions: [],
    idx: 0,
    remaining: 2,
    correctCount: 0,
    log: [], // {prompt,type,correct,answers[]}
  };

  function startQuiz(){
    const em = ui.email.value.trim();
    if (!em || !em.includes('@')) { ui.startInfo.textContent = 'Enter a valid email.'; return; }
    state.email = em;
    state.startISO = new Date().toISOString();
    state.questions = buildQuestions();
    state.idx = 0;
    state.remaining = 2;
    state.correctCount = 0;
    state.log = [];
    ui.start.classList.add('hidden');
    ui.quiz.classList.remove('hidden');
    ui.feedback.textContent = '';
    showQuestion();
  }

  function showQuestion(){
    const q = state.questions[state.idx];
    ui.progress.textContent = `Question ${state.idx+1} of ${state.questions.length}`;
    ui.chances.textContent = `Chances remaining: ${state.remaining}`;
    ui.qText.textContent = q.text;
    ui.answer.value = '';
    ui.answer.focus();
  }

  function ensureFormat(type, raw){
    const s = raw.trim();
    if (type === 'int'){
      if (!/^[-+]?\d+$/.test(s)) return {ok:false, msg:'Enter an integer.'};
      return {ok:true, value: String(parseInt(s,10))};
    }
    if (type === 'float'){
      if (!/^[-+]?\d+\.\d$/.test(s)) return {ok:false, msg:'Enter a float with one decimal place (e.g., 3.0).'};
      const v = Number(s);
      return {ok:true, value: fmt1(v)};
    }
    return {ok:false, msg:'Unexpected type.'};
  }

  function submitAnswer(){
    const q = state.questions[state.idx];
    const chk = ensureFormat(q.type, ui.answer.value);
    if (!chk.ok){ ui.feedback.textContent = chk.msg; ui.feedback.className = 'status bad'; return; }
    const userVal = chk.value;
    const correctNow = (userVal === q.correct);

    // Log attempt
    let entry = state.log[state.idx];
    if (!entry){
      entry = { prompt: q.text, type: q.type, correct: q.correct, answers: [] };
      state.log[state.idx] = entry;
    }
    entry.answers.push(userVal);

    if (correctNow){
      state.correctCount += 1;
      ui.feedback.textContent = 'Correct.';
      ui.feedback.className = 'status good';
      nextQuestion();
      return;
    } else {
      state.remaining -= 1;
      if (state.remaining > 0){
        ui.feedback.textContent = 'Incorrect. Try again.';
        ui.feedback.className = 'status bad';
        ui.chances.textContent = `Chances remaining: ${state.remaining}`;
        ui.answer.focus();
      } else {
        ui.feedback.textContent = `Answer shown: ${q.correct}`;
        ui.feedback.className = 'status';
        nextQuestion();
      }
    }
  }

  function nextQuestion(){
    state.idx += 1;
    state.remaining = 2;
    if (state.idx >= state.questions.length){
      finishQuiz();
    } else {
      showQuestion();
    }
  }

  function finishQuiz(){
    state.stopISO = new Date().toISOString();
    ui.quiz.classList.add('hidden');
    ui.done.classList.remove('hidden');
    const start = new Date(state.startISO), stop = new Date(state.stopISO);
    const elapsed = Math.round((stop - start)/1000);

    const rows = state.log.map((e,i) => {
      const attempts = e.answers && e.answers.length ? e.answers.join(' | ') : '';
      return `<tr><td>${i+1}</td><td>${e.prompt}</td><td>${e.type}</td><td>${e.correct}</td><td>${attempts}</td></tr>`;
    }).join('');

    ui.summary.innerHTML = `
      <p>Email: ${state.email}</p>
      <p>Start: ${state.startISO}</p>
      <p>Stop: ${state.stopISO}</p>
      <p>Time (seconds): ${elapsed}</p>
      <p>Score: ${state.correctCount} / ${state.questions.length}</p>
      <h3>Responses</h3>
      <table class="summary-table">
        <thead><tr><th>#</th><th>Prompt</th><th>Type</th><th>Correct</th><th>Your Attempts</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    `;
  }

  // Wire up
  document.getElementById('startBtn').addEventListener('click', startQuiz);
  document.getElementById('submitBtn').addEventListener('click', submitAnswer);
  document.getElementById('answerInput').addEventListener('keydown', (e)=>{ if (e.key === 'Enter') submitAnswer(); });
})();
</script>
</body>
</html>

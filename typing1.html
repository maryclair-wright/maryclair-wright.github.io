<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2‑Minute Typing Test</title>
  <style>
    :root{
      --bg:#0A2342; --panel:#F4F4F4; --text:#0A2342; --accent:#2E8BFF; --danger:#C62828; --highlight:#FFF59D;
    }
    *{box-sizing:border-box}
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); margin: 0; color: white; }
    .container { max-width: 980px; margin: 0 auto; padding: 24px; }
    .card { background: var(--panel); color: var(--text); border-radius: 16px; padding: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.15); }
    h1 { margin: 0 0 12px 0; font-size: clamp(22px,4vw,30px); }
    label{font-weight:600}
    input[type="email"], textarea { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid #d0d7de; font-size: 14pt; line-height: 2; }
    .row{display:grid; grid-template-columns: 1fr; gap: 12px}
    @media (min-width: 900px){ .row{ grid-template-columns: 1fr 1fr; } }
    .controls{display:flex; gap: 12px; align-items:center; flex-wrap:wrap}
    button{ background: var(--accent); color:white; border: none; border-radius: 999px; padding: 10px 16px; font-weight: 700; cursor: pointer; }
    button[disabled]{opacity:.6; cursor:not-allowed}
    .timer{font-weight: 800; font-size: 20px}
    .notice{ color: var(--danger); font-weight:800; font-size: 18px; }
    .target{ background: white; border-radius: 12px; border: 1px solid #e5e7eb; padding: 18px; font-size: 14pt; line-height: 2; height: 420px; overflow:auto; font-family: Verdana, Arial, sans-serif; white-space: pre-wrap; }
    .typing{ background: white; border-radius: 12px; border: 2px solid #e5e7eb; padding: 18px; font-size: 14pt; line-height: 2; height: 420px; resize: none; font-family: Verdana, Arial, sans-serif; }
    .currentChar{ outline: 2px solid var(--accent); outline-offset: 2px; }
    .currentSentence{ background: var(--highlight); }
    .muted{ color:#5b6974 }
    .results pre{ background:white; border:1px solid #e5e7eb; border-radius:12px; padding:18px; white-space:pre-wrap; font-size: 14pt; line-height: 2; font-family: Verdana, Arial, sans-serif; }
    .font-toggle{margin-top:12px}
    .note { font-size: 12px; color: #666; margin-top: 4px; }
    .typing-notes { margin-top: 30px; background: #f8f8ff; color: #002868; border-radius: 8px; padding: 18px; font-size: 1.1em; max-width: 600px; margin-left: auto; margin-right: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>2‑Minute Typing Test</h1>

    <!-- START SCREEN -->
    <section id="startScreen" class="card">
      <div>
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="student@ascte.org" />
        <div class="note">Enter your school email to get started.</div>
      </div>
      <div class="controls" style="margin-top:12px">
        <button id="startBtn" disabled>Start (2:00)</button>
        <span class="muted" id="attempts">Attempt 1 of 2</span>
      </div>
      <div class="font-toggle">
        <label><input type="checkbox" id="dyslexiaFont" /> Use Dyslexia-Friendly Font</label>
      </div>
      <div class="typing-notes">
        <strong>Typing Test Instructions:</strong><br>
        • You will type for <b>two minutes</b> or until you finish the passage, whichever comes first.<br>
        • <b>Backspace</b> and <b>Delete</b> are <u>not allowed</u> during the test.<br>
        • If you make a mistake, <b>do not try to correct it</b>—just keep typing the next character in the passage.<br>
        • Focus on accuracy and steady typing, not speed alone.<br>
      </div>
    </section>

    <!-- TEST SCREEN -->
    <section id="testScreen" class="card" style="margin-top:16px; display:none">
      <div class="controls" style="justify-content:space-between">
        <div class="timer" id="timer">02:00</div>
        <div class="notice">If you make a mistake, keep going forward.</div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <div class="muted" style="margin-bottom:6px">Target Passage</div>
          <div id="target" class="target" aria-live="polite"></div>
        </div>
        <div>
          <div class="muted" style="margin-bottom:6px">Your Typing</div>
          <textarea id="typing" class="typing" placeholder="Start typing here…" spellcheck="false"></textarea>
        </div>
      </div>
    </section>

    <!-- RESULTS SCREEN -->
    <section id="resultsScreen" class="card" style="margin-top:16px; display:none">
      <h3 style="margin-top:0">Results</h3>
      <div id="summary"></div>
      <div class="results" style="margin-top:12px">
        <div class="muted">Your Output</div>
        <pre id="output"></pre>
      </div>
      <div class="controls" style="margin-top:12px">
        <button id="newAttempt">New Attempt</button>
      </div>
    </section>
  </div>

  <script>
    // ------- Config -------
    const LIMIT_SECONDS = 120; // 2:00
    const MAX_ATTEMPTS = 2;
    const passages = [
      {
        id: 'NASA Marshall',
        text: `NASA’s Marshall Space Flight Center, founded in 1960, is located in Huntsville, Alabama. The center is famous for its role in building the Saturn V rocket that carried astronauts to the Moon. Today, engineers here work on projects such as the Space Launch System (SLS): a powerful rocket designed for deep-space missions.

Why is Marshall important? It provides testing facilities, advanced laboratories, and leadership for programs that shape the future of space travel. Students often visit for tours (both in-person and virtual), where they see real rocket engines and simulators. If you go, you might ask: How did Alabama become home to so much space innovation? The answer goes back to the 1950s/1960s, when Dr. Wernher von Braun and his team moved to Huntsville to lead America’s rocket development.

In addition to rockets, Marshall leads research in propulsion, advanced materials, and even 3D printing for space habitats. Teams work across many fields: physics, chemistry, computer science, and engineering. For example, scientists might ask, “What happens if we use new alloys at 2000°F?” Their experiments often require precise tools that measure forces as small as 0.001 newtons. This kind of testing ensures that spacecraft can survive the extreme conditions of launch and orbit.

The center also partners with universities, companies, and local schools to inspire future scientists. Internships give high school and college students a chance to work side by side with NASA professionals. When you consider the number of projects happening at once—launch vehicles, satellite missions, and deep-space research—it’s clear why Marshall remains central to America’s space program. Visitors often leave asking: What will the next 50 years of discovery bring, and how will Alabama continue to play a role?`
      },
      {
        id: 'USS Alabama',
        text: `The USS Alabama (BB-60), launched in 1942, is a South Dakota-class battleship now anchored in Mobile, Alabama. During World War II, it earned 9 battle stars for service in the Atlantic/Pacific Oceans. Visitors touring the ship today can explore massive gun turrets, narrow passageways, and radar rooms: all reminders of the technology that helped win the war.

Why is the USS Alabama important? It represents the courage of thousands of sailors who served at sea. The ship also provides a living classroom where students can learn about naval engineering, military history, and even basic physics. For instance, guides often ask: How did a vessel weighing over 35,000 tons float? The answer lies in buoyancy, balance, and careful design.`
      }
    ];

    // Track which passage was used for each attempt
    let usedPassages = [];
    let currentPassageIdx = null;

    function pickNewPassage() {
      // Pick a passage not yet used
      const available = passages.map((p, i) => i).filter(i => !usedPassages.includes(i));
      if (available.length === 0) return 0; // fallback
      const idx = available[Math.floor(Math.random() * available.length)];
      usedPassages.push(idx);
      return idx;
    }

    // On first load, pick a passage
    currentPassageIdx = pickNewPassage();
    let passageId = passages[currentPassageIdx].id;
    let passage = passages[currentPassageIdx].text;

    // ------- State -------
    let attempts = 1;
    let timerId = null;
    let startedAt = null;
    let index = 0; // position in passage

    // ------- Elements -------
    const startScreen = document.getElementById('startScreen');
    const testScreen = document.getElementById('testScreen');
    const resultsScreen = document.getElementById('resultsScreen');

    const emailEl = document.getElementById('email');
    const startBtn = document.getElementById('startBtn');
    const attemptsEl = document.getElementById('attempts');

    const timerEl = document.getElementById('timer');
    const targetEl = document.getElementById('target');
    const typingEl = document.getElementById('typing');

    const summaryEl = document.getElementById('summary');
    const outputEl = document.getElementById('output');
    const newAttemptBtn = document.getElementById('newAttempt');
    const dyslexiaToggle = document.getElementById('dyslexiaFont');

    // ------- Helpers -------
    function setTimerDisplay(s){
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const r = Math.floor(s%60).toString().padStart(2,'0');
      timerEl.textContent = `${m}:${r}`;
    }

    function escapeHTML(ch){
      if(ch === '<') return '&lt;';
      if(ch === '>') return '&gt;';
      if(ch === '&') return '&amp;';
      return ch;
    }

    function renderTarget(){
      // Find current sentence boundaries (periods only)
      let sentenceStart = passage.lastIndexOf('.', index-1) + 1;
      if(sentenceStart < 0) sentenceStart = 0;
      let sentenceEnd = passage.indexOf('.', index);
      if(sentenceEnd < 0) sentenceEnd = passage.length;

      const beforeSentence = passage.slice(0, sentenceStart);
      const sentence = passage.slice(sentenceStart, sentenceEnd+1);
      const afterSentence = passage.slice(sentenceEnd+1);

      let sentenceHtml = '';
      for(let i=0;i<sentence.length;i++){
        const globalIndex = sentenceStart+i;
        if(globalIndex === index){
          sentenceHtml += `<span class="currentChar">${escapeHTML(sentence[i])}</span>`;
        } else {
          sentenceHtml += escapeHTML(sentence[i]);
        }
      }

      targetEl.innerHTML = `${escapeHTML(beforeSentence)}<span class="currentSentence">${sentenceHtml}</span>${escapeHTML(afterSentence)}`;
      const sel = targetEl.querySelector('.currentChar');
      if(sel){ sel.scrollIntoView({block:'center'}); }
    }

    function finish(){
      clearInterval(timerId); timerId = null;
      typingEl.disabled = true;
      const seconds = Math.max(1, Math.round((performance.now() - startedAt)/1000));
      const minutes = seconds / 60;

      const typed = typingEl.value;
      let correct = 0;
      for(let i=0; i<typed.length; i++){
        if(typed[i] === passage[i]) correct++;
      }
      const errors = Math.max(0, typed.length - correct);
      const grossWpm = Math.round((typed.length/5) / minutes);
      const accuracy = typed.length ? (correct/typed.length) : 0;
      const netWpm = Math.round((correct/5) / minutes);

      const when = new Date().toLocaleString();
      const email = emailEl.value.trim();
      const lines = [
        `<div><strong>Email:</strong> ${email}</div>`,
        `<div><strong>Completed:</strong> ${when}</div>`,
        `<div><strong>Passage:</strong> ${passageId}</div>`,
        `<div><strong>Elapsed:</strong> ${seconds}s</div>`,
        `<div><strong>Gross WPM:</strong> ${grossWpm}</div>`,
        `<div><strong>Accuracy:</strong> ${Math.round(accuracy*100)}%</div>`,
        `<div><strong>Net WPM:</strong> ${netWpm}</div>`,
        `<div><strong>Chars typed:</strong> ${typed.length} &nbsp;|&nbsp; <strong>Correct:</strong> ${correct} &nbsp;|&nbsp; <strong>Errors:</strong> ${errors}</div>`
      ];
      summaryEl.innerHTML = lines.join('');
      outputEl.textContent = typed;

      testScreen.style.display = 'none';
      resultsScreen.style.display = 'block';
    }

    function start(){
      startedAt = performance.now();
      index = 0; typingEl.value = ''; typingEl.disabled = false; typingEl.focus();
      
      renderTarget();
      testScreen.style.display = 'block';
      startScreen.style.display = 'none';

      let remaining = LIMIT_SECONDS;
      setTimerDisplay(remaining);
      timerId = setInterval(()=>{
        remaining--; setTimerDisplay(remaining);
        if(remaining <= 0){ finish(); }
      }, 1000);
    }

    // ------- Event wiring -------
    function validToStart(){
      const ok = emailEl.value.trim() !== '';
      startBtn.disabled = !ok;
    }

    emailEl.addEventListener('input', validToStart);
    startBtn.addEventListener('click', start);

    newAttemptBtn.addEventListener('click', ()=>{
      attempts++;
      if(attempts > MAX_ATTEMPTS){
        newAttemptBtn.disabled = true;
        return;
      }
      // Pick a different passage for the new attempt
      currentPassageIdx = pickNewPassage();
      passageId = passages[currentPassageIdx].id;
      passage = passages[currentPassageIdx].text;
      attemptsEl.textContent = `Attempt ${attempts} of ${MAX_ATTEMPTS}`;
      resultsScreen.style.display = 'none';
      startScreen.style.display = 'block';
      validToStart();
    });

    typingEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Backspace' || e.key === 'Delete'){
        e.preventDefault(); return false;
      }
      if((e.ctrlKey||e.metaKey) && ['v','x','a','c'].includes(e.key.toLowerCase())){
        e.preventDefault(); return false;
      }
    });

    typingEl.addEventListener('paste', e=> e.preventDefault());
    typingEl.addEventListener('copy', e=> e.preventDefault());
    typingEl.addEventListener('cut', e=> e.preventDefault());
    typingEl.addEventListener('contextmenu', e=> e.preventDefault());

    typingEl.addEventListener('input', ()=>{
      typingEl.selectionStart = typingEl.selectionEnd = typingEl.value.length;
      let len = typingEl.value.length;
      if(len >= passage.length){
        typingEl.value = typingEl.value.slice(0, passage.length);
        index = passage.length;
        renderTarget();
        finish();
        return;
      }
      index = len;
      renderTarget();
    });

    // Toggle dyslexia-friendly font
    const dyslexiaToggleEl = dyslexiaToggle; // alias for clarity
    dyslexiaToggleEl.addEventListener('change', ()=>{
      const font = dyslexiaToggleEl.checked ? 'OpenDyslexic, Verdana, Arial, sans-serif' : 'Verdana, Arial, sans-serif';
      document.querySelectorAll('.target, .typing, .results pre').forEach(el=>{
        el.style.fontFamily = font;
      });
    });

    setTimerDisplay(LIMIT_SECONDS);
    renderTarget();
    attemptsEl.textContent = `Attempt ${attempts} of ${MAX_ATTEMPTS}`;
    validToStart();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Casting Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Serif', serif;
            background-color: #FFFFF5;
            text-align: center;
            margin-top: 50px;
        }
        .container {
            max-width: 700px;
            margin: 40px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            padding: 32px 24px;
        }
        h1 {
            color: #002868;
        }
        .problem {
            background: #F8FAFC;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 24px;
            text-align: left;
        }
        .problem pre {
            background: #222;
            color: #98FB98;
            padding: 10px;
            border-radius: 6px;
            font-size: 1em;
            margin-bottom: 10px;
        }
        .problem label {
            font-weight: bold;
        }
        .problem input[type="text"] {
            width: 100%;
            padding: 8px;
            font-size: 1em;
            border-radius: 5px;
            border: 1px solid #bbb;
            margin-bottom: 8px;
        }
        .feedback {
            font-size: 1.1em;
            margin-top: 6px;
        }
        .correct { color: #228B22; }
        .incorrect { color: #B22222; }
        .footer {
            margin-top: 40px;
            color: #002868;
            font-size: 15px;
        }
        #emailSection {
            margin-bottom: 30px;
        }
        #summary {
            margin-top: 30px;
            background: #f8f8ff;
            color: #002868;
            border-radius: 8px;
            padding: 18px;
            font-size: 1.1em;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <h1>Casting Practice</h1>
        <div id="emailSection">
            <label for="emailInput"><b>Enter your school email to get started:</b></label><br>
            <input type="email" id="emailInput" placeholder="your.email@school.org" style="width:300px; padding:8px; margin:10px 0; border-radius:5px; border:1px solid #bbb; font-size:1em;" />
            <br>
            <button onclick="startPractice()" id="startBtn">Start Practice</button>
            <div id="emailError" style="color:#B22222; margin-top:8px;"></div>
        </div>
        <div id="problems" style="display:none;"></div>
        <div id="summary" style="display:none;"></div>
    </div>
    <div class="footer">
        These tools were developed for teaching Cyber101 and AP Computer Science Principles at ASCTE by Mary Clair Wright and ASCTE Student Interns.
    </div>
    <script>
    // Random values for each session
    const randAge = Math.floor(Math.random()*10)+13; // 13–22
    const randScore = Math.floor(Math.random()*50)+50; // 50–99
    const randValue = (Math.random()*10).toFixed(1);   // 0.0–9.9

    const problems = [
      {
        prompt: 'What will be displayed when this code runs?',
        code: `age = ${randAge}\nprint("Age: " + str(age))`,
        answer: `Age: ${randAge}`
      },
      {
        prompt: 'What will be displayed when this code runs?',
        code: `print(str(${randScore}) + " is the Score")`,
        answer: `${randScore} is the Score`
      },
      {
        prompt: 'What will be displayed when this code runs?',
        code: `pi = 3.14\nprint("Pi is " + str(pi))`,
        answer: `Pi is 3.14`
      },
      {
        prompt: 'What will be displayed when this code runs?',
        code: `value = ${randValue}\nprint("Casted: " + str(int(value)))`,
        answer: `Casted: ${parseInt(randValue)}`
      }
    ];

    const codeProblems = [
      {
        prompt: 'Store the user\'s favorite color in a variable named color. Use exactly this prompt text: "Enter your favorite color"',
        solution: 'color = input("Enter your favorite color")'
      },
      {
        prompt: 'Store the first letter of the user\'s last name in a variable named letter. Use exactly this prompt text: "Enter the first letter of your last name"',
        solution: 'letter = input("Enter the first letter of your last name")'
      },
      {
        prompt: 'Store a random number between 0.5 and 0.99 in a variable named guess. Use exactly this prompt text: "Enter a random number between 0.5 and 0.99"',
        solution: 'guess = float(input("Enter a random number between 0.5 and 0.99"))'
      },
      {
        prompt: 'Store the best decimal value in a variable named decimal. Use exactly this prompt text: "What is the best decimal value?"',
        solution: 'decimal = float(input("What is the best decimal value?"))'
      },
      {
        prompt: 'Store a number between 10 and 20 in a variable named digit. Use exactly this prompt text: "Enter a number between 10 and 20"',
        solution: 'digit = int(input("Enter a number between 10 and 20"))'
      },
      {
        prompt: 'Store the best highway speed limit in a variable named speed. Use exactly this prompt text: "What is the best speed limit for the highway?"',
        solution: 'speed = int(input("What is the best speed limit for the highway?"))'
      }
    ];

    let userEmail = '';
    let startTime = null;
    let stopTime = null;
    let correctCount = 0;
    let attemptedCount = 0;

    function startPractice() {
      const emailInput = document.getElementById('emailInput');
      const email = emailInput.value.trim();
      const errorDiv = document.getElementById('emailError');
      if (!/.+@.+\..+/.test(email)) {
        errorDiv.textContent = 'Please enter a valid email address.';
        return;
      }
      errorDiv.textContent = '';
      userEmail = email;
      startTime = new Date();
      document.getElementById('emailSection').style.display = 'none';
      document.getElementById('problems').style.display = '';
      renderProblems();
    }

    // Track attempts for both steps
    let outputAttempts = [];
    let codeAttempts = [];
    let currentStep = 1; // 1 = output, 2 = code-writing
    function renderCodeProblems() {
      const container = document.getElementById('problems');
      container.innerHTML = '';
      codeAttempts = [0, 0, 0];
      // Pick one string, one float, one int problem randomly
      const stringProb = codeProblems[Math.floor(Math.random()*2)];
      const floatProb = codeProblems[2 + Math.floor(Math.random()*2)];
      const intProb = codeProblems[4 + Math.floor(Math.random()*2)];
      const selected = [stringProb, floatProb, intProb];
      window.selectedCodeProblems = selected;
      selected.forEach((prob, idx) => {
        const div = document.createElement('div');
        div.className = 'problem';
        div.innerHTML = `
          <div><b>Code Problem ${idx+1}:</b> ${prob.prompt}</div>
          <label for="codeAnswer${idx}">Type the exact line of code:</label><br>
          <input type="text" id="codeAnswer${idx}" autocomplete="off" />
          <button onclick="checkCodeAnswer(${idx})">Check</button>
          <span class="feedback" id="codeFeedback${idx}"></span>
        `;
        container.appendChild(div);
      });
      // Add finish button
      const finishBtn = document.createElement('button');
      finishBtn.textContent = 'Finish & Show Summary';
      finishBtn.style = 'margin-top:20px; padding:10px 24px; font-size:1em; border-radius:6px; background:#002868; color:#fff; border:none;';
      finishBtn.onclick = finishPractice;
      container.appendChild(finishBtn);
    }

    function checkCodeAnswer(idx) {
      const input = document.getElementById('codeAnswer'+idx);
      const feedback = document.getElementById('codeFeedback'+idx);
      if (!input.value.trim()) {
        feedback.textContent = '';
        return;
      }
      const solution = window.selectedCodeProblems[idx].solution;
      // Normalize whitespace for comparison
      const normalize = s => s.replace(/\s+/g, ' ').trim();
      if (normalize(input.value) === normalize(solution)) {
        feedback.textContent = 'Correct!';
        feedback.className = 'feedback correct';
        correctCount++;
        input.disabled = true;
      } else {
        codeAttempts[idx] = (codeAttempts[idx] || 0) + 1;
        if (codeAttempts[idx] < 2) {
          feedback.textContent = 'Try again!';
          feedback.className = 'feedback incorrect';
        } else {
          feedback.textContent = `Incorrect. Expected: ${solution}`;
          feedback.className = 'feedback incorrect';
          input.disabled = true;
        }
      }
      attemptedCount++;
    }

    function renderProblems() {
      const container = document.getElementById('problems');
      container.innerHTML = '';
      correctCount = 0;
      attemptedCount = 0;
      outputAttempts = problems.map(() => 0);
      problems.forEach((prob, idx) => {
        const div = document.createElement('div');
        div.className = 'problem';
        div.innerHTML = `
          <div><b>Problem ${idx+1}:</b> ${prob.prompt}</div>
          <pre>${prob.code}</pre>
          <label for="answer${idx}">Type the exact output:</label><br>
          <input type="text" id="answer${idx}" autocomplete="off" />
          <button onclick="checkAnswer(${idx})">Check</button>
          <span class="feedback" id="feedback${idx}"></span>
        `;
        container.appendChild(div);
      });
      // Add next step button
      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'Next: Code Writing Problems';
      nextBtn.style = 'margin-top:20px; padding:10px 24px; font-size:1em; border-radius:6px; background:#002868; color:#fff; border:none;';
      nextBtn.onclick = function() {
        currentStep = 2;
        renderCodeProblems();
      };
      container.appendChild(nextBtn);
    }

    function checkAnswer(idx) {
      const input = document.getElementById('answer'+idx);
      const feedback = document.getElementById('feedback'+idx);
      if (!input.value.trim()) {
        feedback.textContent = '';
        return;
      }
      if (input.value.trim() === problems[idx].answer) {
        feedback.textContent = 'Correct!';
        feedback.className = 'feedback correct';
        correctCount++;
        input.disabled = true;
      } else {
        outputAttempts[idx] = (outputAttempts[idx] || 0) + 1;
        if (outputAttempts[idx] < 2) {
          feedback.textContent = 'Try again!';
          feedback.className = 'feedback incorrect';
        } else {
          feedback.textContent = `Incorrect. Expected: ${problems[idx].answer}`;
          feedback.className = 'feedback incorrect';
          input.disabled = true;
        }
      }
      attemptedCount++;
    }

    function finishPractice() {
      stopTime = new Date();
      document.getElementById('problems').style.display = 'none';
      showSummary();
    }

    function showSummary() {
      const summaryDiv = document.getElementById('summary');
      summaryDiv.style.display = '';
      summaryDiv.innerHTML = `
        <h2>Session Summary</h2>
        <b>Email:</b> ${userEmail}<br>
        <b>Start Time:</b> ${startTime ? startTime.toLocaleString() : ''}<br>
        <b>Stop Time:</b> ${stopTime ? stopTime.toLocaleString() : ''}<br>
        <b>Correct Answers:</b> ${correctCount} / ${problems.length}<br>
        <b>Questions Attempted:</b> ${attemptedCount} / ${problems.length}
      `;
    }
    </script>
</body>
</html>
